// Generated by CoffeeScript 2.5.1
(function() {
  module.exports = function(app) {
    var hashes;
    hashes = [];
    return {
      pre: function(scope, elem, props) {
        var arr, itemName, myrepeat, repeat, results;
        itemName = 'item';
        repeat = props.repeat;
        myrepeat = repeat.replace(/\sas\s([\w_]+)$/, function(all, name) {
          itemName = name;
          return '';
        });
        arr = app.$eval(myrepeat, scope);
        if (arr) {
          results = arr.map(function(item, i) {
            var hash, hashIndex, newscope;
            hash = app.$hash(JSON.stringify(item));
            hashIndex = hashes.indexOf(hash);
            newscope = app.Scope(scope);
            newscope[itemName] = item;
            newscope.$index = i;
            newscope.$first = i === 0;
            newscope.$last = i === arr.length - 1;
            newscope.$fresh = hashIndex === -1;
            newscope.$moveUp = hashIndex > i;
            newscope.$moveDown = hashIndex !== -1 && hashIndex < i;
            newscope.$lastIndex = hashIndex;
            //newscope.$dataid = app.$hash JSON.stringify app.$hashObject newscope
            return newscope;
          });
          if (scope.$phase === 'render') {
            hashes = results.map(function(scope) {
              return app.$hash(JSON.stringify(scope[itemName]));
            });
          }
          return results;
        } else {
          return [];
        }
      }
    };
  };

}).call(this);

//# sourceMappingURL=repeat.js.map
